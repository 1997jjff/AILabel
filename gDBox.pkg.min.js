!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.gDBox=e()}(this,function(){var s;s=!1,gClass=function(){},gClass.extend=function(t){var i=null;function e(){s||(i&&(this._superprototype=i.prototype),this.init.apply(this,arguments))}for(var n in this!==gClass&&(i=this),i&&(s=!0,(e.prototype=new i).constructor=e,s=!1),e.extend=arguments.callee,t)t.hasOwnProperty(n)&&(e.prototype[n]=i&&"function"==typeof t[n]&&"function"==typeof e.prototype[n]&&/\b_super\b/.test(t[n])?function(t,e){return function(){return this._super=i.prototype[t],e.apply(this,arguments)}}(n,t[n]):t[n]);return e};var t,y={};function e(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}return y.config={version:"1.1.0"},y.Util={},y.Util.createDiv=function(t,e,i,n){var s=document.createElement("div");return s.id=t,s.style.width=e+"px",s.style.height=i+"px",n&&(s.style.position="absolute"),s.style.zIndex=1,s},y.Util.createCanvas=function(t,e,i,n){var s=document.createElement("canvas");return s.id=t,s.width=e,s.height=i,s.style.width=e+"px",s.style.height=i+"px",n&&(s.style.position="absolute"),s},y.Util.isInArray=function(t,e){for(var i in t)if(t[i]==e)return!0;return!1},y.Util.isObjInArray=function(t,e){for(var i in t)if(t[i].id==e.id)return alert("已被添加，请更换图层id"+e.id),!0;return!1},y.Util.setStyle=function(t,e){return t.fillStyle=e.fillColor,t.strokeStyle=e.strokeColor,t.lineWidth=e.lineWeight,t.globalAlpha=e.opacity,!0},y.Util.worldToScreen=function(t,e,i){var n=t.getCenter(),s=n.x,o=n.y,r=parseInt(t.w)/2,a=parseInt(t.h)/2,h=t.zoom/parseInt(t.w);return{x:parseFloat(r)+parseFloat((e-s)/h)+0,y:parseFloat(a)-parseFloat((i-o)/h)+0}},y.Util.screenToWorld=function(t,e,i){var n=t.getCenter(),s=n.x,o=n.y,r=parseInt(t.w)/2,a=parseInt(t.h)/2,h=t.zoom/parseInt(t.w);return{x:parseFloat(s)+parseFloat((e-r)*h),y:parseFloat(o)-parseFloat((i-a)*h)}},y.Util.addEvtHandler=function(t,e,i){t["on"+e]=i,"mousewheel"==e&&0==y.Util.getIEVersion()&&t.addEventListener("DOMMouseScroll",i,!1)},y.Util.removeEvtHandler=function(t,e){t["on"+e]=null},y.Util.getMouseXY=function(t,e){var i=0,n=0,s=e.srcElement?e.srcElement:e.target;if(1!=s.nodeType)return{x:i,y:n};if(document.attachEvent){o="medium"==y.Util.getEleStyle(s,"border-top-width")?0:y.Util.delpx(y.Util.getEleStyle(s,"border-top-width")),r="medium"==y.Util.getEleStyle(s,"border-left-width")?0:y.Util.delpx(y.Util.getEleStyle(s,"border-left-width"));i=e.layerX-r,n=e.layerY-o}else{for(;s&&s!=t;){var o="medium"==y.Util.getEleStyle(s,"border-top-width")?0:y.Util.delpx(y.Util.getEleStyle(s,"border-top-width")),r="medium"==y.Util.getEleStyle(s,"border-left-width")?0:y.Util.delpx(y.Util.getEleStyle(s,"border-left-width"));i+=s.offsetLeft+r,n+=s.offsetTop+o,s=s.offsetParent}i=e.offsetX+i+document.body.scrollLeft,n=e.offsetY+n+document.body.scrollTop}return{x:i,y:n}},y.Util.getMousePos=function(t){var e=t||window.event;return{x:e.screenX,y:e.screenY}},y.Util.getEleStyle=function(t,e){var i=e.split("-"),n=i[0];if(1<n.length)for(var s=1;s<i.length;s++)n+=i[s].substring(0,1).toUpperCase()+i[s].substring(1);else n=e;return t.currentStyle?t.currentStyle[n]:document.defaultView.getComputedStyle(t,!1)[n]},y.Util.delpx=function(t){return""==t?0:parseInt(t.substring(0,t.length-2))},y.Util.getRectPointsWithSAndE=function(t,e){var i=e.x,n=t.y,s=t.x,o=e.y;return[{x:t.x,y:t.y},{x:i,y:n},{x:e.x,y:e.y},{x:s,y:o}]},y.Util.pointInPoly=function(t,e){for(var i=!1,n=-1,s=e.length,o=s-1;++n<s;o=n)(e[n].y<=t.y&&t.y<e[o].y||e[o].y<=t.y&&t.y<e[n].y)&&t.x<(e[o].x-e[n].x)*(t.y-e[n].y)/(e[o].y-e[n].y)+e[n].x&&(i=!i);return i},y.Util.preventDefault=function(t){t.preventDefault?t.preventDefault():window.event.returnValue=!1},y.Util.stopPropagation=function(t){t.stopPropagation?t.stopPropagation():window.event.cancelBubble=!0},y.Util.getButton=function(t){if(t=t||window.event,+[1])return t.button;switch(t.button){case 0:case 1:case 3:case 5:case 7:return 0;case 2:case 6:return 2;case 4:return 1}},y.Util.createTextArea=function(t,e,i,n){var s=document.createElement("textarea");return s.id=t,s.style.width=e+"px",s.style.height=i+"px",s.style.resize="none",n&&(s.style.position="absolute"),s.style.zIndex=1,s},y.Util.colorRgb=function(t,e){var i=t.toLowerCase();if(i&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(i)){if(4===i.length){for(var n="#",s=1;s<4;s+=1)n+=i.slice(s,s+1).concat(i.slice(s,s+1));i=n}var o=[];for(s=1;s<7;s+=2)o.push(parseInt("0x"+i.slice(s,s+2)));return"RGBA("+o.join(",")+","+e+")"}return i},y.Util.getIEVersion=function(){var t=window.navigator.userAgent.toLowerCase();return/msie 8\.0/i.test(t)?8:/msie 7\.0/i.test(t)?7:/msie 6\.0/i.test(t)?6:0},y.Graph={},y.Graph.drawPoint=function(t,e){t.beginPath(),t.arc(e.x,e.y,2,0,2*Math.PI,!0),t.closePath(),t.fill()},y.Graph.drawPoint_geo=function(t,e,i){var n=y.Util.worldToScreen(t,i.x,i.y);e.beginPath(),e.arc(n.x,n.y,3,0,2*Math.PI,!0),e.closePath(),e.fill()},y.Graph.drawPoints=function(t,e){for(var i=0;i<e.length;i++){var n={x:e[i].x,y:e[i].y};this.drawPoint(t,n)}},y.Graph.drawPoints_geo=function(t,e,i){for(var n=0;n<i.length;n++){var s=y.Util.worldToScreen(t,i[n].x,i[n].y);this.drawPoint(e,s)}},y.Geometry=gClass.extend({init:function(t){this.name=t},getVertices:function(){},getBounds:function(){},calcBounds:function(){}}),y.Geometry.Point=gClass.extend({init:function(t,e){this.x=t,this.y=e,this.className="point"}}),y.Geometry.LineString=y.Geometry.extend({init:function(t){this.className="line",this.points=[];for(var e=0;e<t.length;e++){var i=t[e];i instanceof y.Geometry.Point?this.points.push(i):alert("初始化节点失败！")}},addPoint:function(t,e){/^\d+$/.test(e)?this.points.splice(e,0,t):this.points.push(t)},delPoint:function(t){this.points.splice(t,1)},removePoint:function(t){for(var e=0;e<this.points.length;e++)if(this.points[e]==t){this.points.splice(e,1);break}},getLength:function(){for(var t=this.points.length,e=0,i=0;i<t-1;i++){e+=Math.sqrt((this.points[i].x-this.points[i+1].x)*(this.points[i].x-this.points[i+1].x)+(this.points[i].y-this.points[i+1].y)*(this.points[i].y-this.points[i+1].y))}return e}}),y.Geometry.LinearRing=y.Geometry.LineString.extend({init:function(t){if(t.length<=2)alert("组成多边形节点个数不足！");else{this._super(t),this.className="polygon";var e=t[0];this.points.push(e)}},addPoint:function(t,e){this.points.splice(e,0,t)},delPoint:function(t){if(4!=this.points.length){if(this.points.splice(t,1),0==t){this.points.pop();var e=this.points[0];this.points.push(e)}}else alert("节点数低于3个，不能删除！")},getCenterPoint:function(){for(var t=this.points,e=t.length,i=0,n=0,s=0;s<e;s++)i+=t[s].x,n+=t[s].y;var o=i/e,r=n/e;return new y.Geometry.Point(o,r)},getArea:function(){for(var t=0,e=this.points,i=0;i<e.length;i++)t+=e[i].x*e[(i+1)%e.length].y-e[(i+1)%e.length].x*e[i].y;return parseInt(Math.abs(.5*t))}}),y.Geometry.RectRing=y.Geometry.LineString.extend({init:function(t){t.length<4?alert("组成矩形节点个数不足！"):(this._super(t),this.className="rect")},addPoint:function(t,e){this.points.splice(e,0,t)},delPoint:function(t){if(4!=this.points.length){if(this.points.splice(t,1),0==t){this.points.pop();var e=this.points[0];this.points.push(e)}}else alert("节点数低于3个，不能删除！")},getArea:function(){for(var t=0,e=this.points,i=0;i<e.length;i++)t+=e[i].x*e[(i+1)%e.length].y-e[(i+1)%e.length].x*e[i].y;return parseInt(Math.abs(.5*t))}}),y.Geometry.RadiusRing=y.Geometry.extend({init:function(t,e){this.radius=e,this.centerPoint=t,this.className="radius"},getArea:function(){return 6.28318*this.radius*this.radius}}),y.Feature=gClass.extend({init:function(){},getVertices:function(){return this.points},getBounds:function(){for(var t=this.getVertices(),e=t[0].x,i=t[0].y,n=t[0].x,s=t[0].y,o=1;o<t.length;o++)e>t[o].x&&(e=t[o].x),n<t[o].x&&(n=t[o].x),i>t[o].y&&(i=t[o].y),s<t[o].y&&(s=t[o].y);return[{x:e,y:s},{x:n,y:s},{x:n,y:i},{x:e,y:i}]},calcBounds:function(){}}),y.Feature.Polygon=y.Feature.extend({init:function(t,e,i,n){this.activeSatus=!1,this.hoverStatus=!1,this.id=t,this.points=e,this.data=i||{},this.gStyle=n},onAdd:function(t){this._layerID=t.id,this._layer=t,this.style=this.gStyle||t.featureStyle||new y.Style({}),this.hoveStyle=t.featureHoverStyle||new y.Style({strokeColor:"#FF0000",lineWeight:2}),this.activeStyle=t.featureActiveStyle||new y.Style({strokeColor:"#FF0000",lineWeight:2}),this.onDraw(t)},onRemove:function(t){},update:function(t){this.points=t.points||this.points,this.data=t.data||this.data,this.style=t.style||this.style,this._layer.renew()},pointInFeature:function(t){return!!y.Util.pointInPoly(t,this.points)},hover:function(t){this.hoverStatus||(this.hoveStyle=t||this.hoveStyle,this.hoverStatus=!0,this._layer.renew())},deHover:function(){this.hoverStatus&&(this.hoverStatus=!1,this._layer.renew())},active:function(t){this.activeSatus||(this.activeStyle=t||this.activeStyle,this.activeSatus=!0,this._layer.renew())},deActive:function(){this.activeSatus&&(this.activeSatus=!1,this._layer.renew())},getStyle:function(){return this.activeSatus?this.activeStyle:this.hoverStatus?this.hoveStyle:this.style},onDraw:function(t){var e=t.getCtx(),i=this.getStyle();y.Util.setStyle(e,i),i.lineDash?e.setLineDash([10,5]):e.setLineDash([]);var n=t.getMap();e.globalAlpha=1;var s=this.points.length;if(2<=s){e.beginPath();var o=y.Util.worldToScreen(t._map,this.points[0].x,this.points[0].y);e.moveTo(o.x,o.y);for(var r=1;r<s;r++)o=y.Util.worldToScreen(t._map,this.points[r].x,this.points[r].y),e.lineTo(o.x,o.y);e.closePath()}e.stroke(),t._opacity?e.globalAlpha=0:e.globalAlpha=this.style.opacity,e.fill(),this.activeSatus&&(e.globalAlpha=1,e.fillStyle="#FF0000",y.Graph.drawPoints_geo(n,e,this.points))}}),y.Marker=gClass.extend({init:function(t,e){this.id=t,this._img=new Image,this._img.src=e.src,this.src=e.src,this._img.style.position="absolute",this._img.style.zIndex=100,this.info=e},onAdd:function(t){var e=(this._layer=t).getMap(),i=this._container=t.getLayerContainer();this.x=this.info.x,this.y=this.info.y;var n=y.Util.worldToScreen(e,this.info.x,this.info.y);this._img.style.left=n.x+this.info.offset.x+"px",this._img.style.top=n.y+this.info.offset.y+"px",this._img.style.cursor="pointer",i.appendChild(this._img)},onRemove:function(){this._container.removeChild(this._img)},regEvent:function(t,e){if("click"==t){var i=this;y.Util.addEvtHandler(this._img,"mousedown",function(t){y.Util.preventDefault(t),y.Util.stopPropagation(t)}),y.Util.addEvtHandler(this._img,"mouseup",function(t){0==y.Util.getButton(t)&&e.apply(i,arguments),y.Util.preventDefault(t),y.Util.stopPropagation(t)}),y.Util.addEvtHandler(this._img,"click",function(t){y.Util.preventDefault(t),y.Util.stopPropagation(t)})}},renew:function(){var t=this._layer.getMap(),e=y.Util.worldToScreen(t,this.info.x,this.info.y);this._img.style.left=e.x+this.info.offset.x+"px",this._img.style.top=e.y+this.info.offset.y+"px"},showInfo:function(){console.log("Hello ...")}}),y.Text=gClass.extend({init:function(t,e,i){this.id=t,this.startPoint=e.pos,this.offset=e.offset||{x:0,y:0},this.boxMaxWidth=e.width,this.wrap=e.wrap||!1,this.text=e.text,this.style=i||new y.Style({})},onAdd:function(t){var e=this.id;this._w=this.boxMaxWidth;var i=y.Util.createDiv(e,this._w,this._h,!0);i.style.borderWidth=0,i.style.width="initial",i.style.maxWidth=this._w+"px",this.wrap||(i.style.overflow="hidden",i.style.textOverflow="ellipsis",i.style.whiteSpace="nowrap"),this._textContainer=i,(this._container=t.getLayerContainer()).appendChild(this._textContainer),this._layer=t,this.onDraw(t)},onDraw:function(t){var e=y.Util.worldToScreen(t._map,this.startPoint.x,this.startPoint.y);e.x=e.x+this.offset.x,e.y=e.y+this.offset.y,this._textContainer.style.fontSize=this.style.fontSize+"px",this._textContainer.style.lineHeight=this.style.fontSize+"px",this._textContainer.style.fontFamily=this.style.fontFamily+",SimSun",this._textContainer.style.color=this.style.fontColor,this._textContainer.style.borderRadius="1px",this._textContainer.style.boxSizing="border-box",this._textContainer.style.padding="1px";var i=y.Util.colorRgb(this.style.bgColor,this.style.opacity||1);this._textContainer.style.background=i,this._textContainer.textContent=this.text,this._textContainer.style.left=e.x+"px",this._textContainer.style.top=e.y+"px",t._layerContainer.appendChild(this._textContainer)},setText:function(t){this.text=t,this.refresh()},setPosition:function(t,e){this.startPoint.x=t,this.startPoint.y=e},setSize:function(t){this._w=this.boxMaxWidth=t},onRemove:function(){this._container.removeChild(this._textContainer)},getContainer:function(){return this._textContainer},renew:function(){var t=this._layer;this.onDraw(t)},refresh:function(){this.renew()}}),y.Style=gClass.extend({init:function(t){this.oStyle="singleStyle",this.fillColor=t.fillColor?t.fillColor:"#00DD00",this.strokeColor=t.strokeColor?t.strokeColor:"#00DD00",this.lineWeight=t.lineWeight?t.lineWeight:1,this.borderStatus=!t.borderStatus||t.borderStatus,this.cirRadius=t.cirRadius?t.cirRadius:3,this.fillStatus=!t.fillStatus||t.fillStatus,this.vtxStatus=!!t.vtxStatus&&t.vtxStatus,this.vtxRadius=t.vtxRadius?t.vtxRadius:3,this.tlr=t.tlr?t.tlr:5,this.opacity=t.opacity?t.opacity:1,this.mappingValue=t.mappingValue?t.mappingValue:"default",this.fontSize=t.fontSize?t.fontSize:13,this.fontFamily=t.fontFamily?t.fontFamily:"KaiTi",this.fontColor=t.fontColor?t.fontColor:"#333333",this.bgColor=t.bgColor?t.bgColor:"#ffffff",this.lineDash=t.lineDash||!1}}),y.Style_Ex=gClass.extend({init:function(t,e){this.oStyle="multiStyles",this.styles=t,this.mappingField=e}}),y.Map=gClass.extend((e(t={init:function(t,e){this._options=e||{},this._initContainer(t),this._initProp(),this._initEvent(),this.overLayer=new y.Layer.Overlay("overlay"),this.mLayer=new y.Layer.Marker("markerLayer"),this.addLayer(this.overLayer),this.addLayer(this.mLayer)},_initContainer:function(t){this._container=document.getElementById(t),this._container.innerHTML="",this.w=this._options.w||this._container.clientWidth,this.h=this._options.h||this._container.clientHeight,this._container.style.overflow="hidden"},getContainer:function(){return this._container},getSize:function(){return{w:this.w,h:this.h}},events:{on:function(t,i){switch(t){case"mouseDown":y.Map.prototype.userMouseDown=function(t){var e=i(t);return"boolean"!=typeof e||e};break;case"geometryDone":y.Map.prototype.userGeometryDone=function(t,e){i(t,e)};break;case"featureSelected":y.Map.prototype.userFetureSelected=function(t){i(t)};break;case"hover":y.Map.prototype.userFetureHover=function(t){i(t)}}}},userMouseDown:function(){return!0},userGeometryDone:function(){},userFetureSelected:function(){},userFetureHover:function(){},_initProp:function(){this.mode="pan",this.dragging=!1,this.oLayers=[],this.zoom=this._options.zoom||parseInt(1*this.w,10),this.cx=this._options.cx||0,this.cy=this._options.cy||0,this.startX=0,this.startY=0,this.startScrX=0,this.startSrcY=0,this.zoomScale=.025,this.zoomMax=this._options.zoomMax||1e9,this.zoomMin=this._options.zoomMin||0,this.drawRectPoints=[]},_initEvent:function(){var f=this,t=(document.documentElement,this._container);y.Util.addEvtHandler(t,"mousedown",function(t){var e=t||window.event;window.event||e.preventDefault();var i=y.Util.getMouseXY(f._container,e),n=y.Util.screenToWorld(f,i.x,i.y),s=y.Util.getMousePos(e);if(f.startX=i.x,f.startY=i.y,f.startScrX=s.x,f.startScrY=s.y,f.resetLayerStatus(),!f.userMouseDown(n))return;"pan"===f.mode?(!function(t){f.dragging=!0;for(var e=f.getAllLayers(),i=0;i<e.length;i++)e[i].startLeft=y.Util.delpx(e[i]._layerContainer.style.left),e[i].startTop=y.Util.delpx(e[i]._layerContainer.style.top)}(),document.onmousemove=function(t){!function(t){y.Util.getMouseXY(f._container,t);var e=y.Util.getMousePos(t);if(f.dragging){var i=e.x-f.startScrX,n=e.y-f.startScrY,s=f.getAllLayers();if(0<Math.abs(i)||0<Math.abs(n))for(var o=0;o<s.length;o++)s[o].onDrag(i,n)}}(t)},document.onmouseup=function(t){document.onmousemove=null,document.onmouseup=null,function(t){y.Util.getMouseXY(f._container,t);var e=y.Util.getMousePos(t),i=e.x-f.startScrX,n=e.y-f.startScrY;if(0<Math.abs(i)||0<Math.abs(n)){var s=f.getScreenCenter(),o=s.x-i,r=s.y-n,a=y.Util.screenToWorld(f,o,r);f.setCenter(a.x,a.y);for(var h=f.getAllLayers(),l=h.length,u=0;u<l;u++)h[u].renew()}f.dragging=!1}(t)}):function(t){var e=y.Util.getMouseXY(f._container,t),i=y.Util.screenToWorld(f,e.x,e.y);switch(f.mode){case"drawRect":var n=new y.Geometry.Point(i.x,i.y);f.drawRectPoints.push(n)}}(e)}),y.Util.addEvtHandler(t,"mousemove",function(t){var e=y.Util.getMouseXY(f._container,t),i=y.Util.screenToWorld(f,e.x,e.y);switch(f.mode){case"drawRect":if(0<f.drawRectPoints.length){f.overLayer.clear();var n=f.overLayer.getCtx();y.Util.setStyle(n,f.globalStyle);var s=e.x-f.startX,o=e.y-f.startY;n.strokeRect(f.startX,f.startY,s,o)}}f.setTargets(i,"hover")}),y.Util.addEvtHandler(t,"mouseup",function(t){var e=y.Util.getMouseXY(f._container,t),i=y.Util.screenToWorld(f,e.x,e.y),n=!1;switch(f.mode){case"drawRect":if(0<f.drawRectPoints.length){var s=f.drawRectPoints[0];f.drawRectPoints=[];var o=new y.Geometry.Point(i.x,i.y),r=y.Util.getRectPointsWithSAndE(s,o);f.overLayer.clear(),10<Math.abs(r[0].x-r[2].x)&&10<Math.abs(r[0].y-r[2].y)?(n=!0,f.userGeometryDone&&f.userGeometryDone("rect",r)):console.log("invalid points data: 绘制矩形 —— 不是有效矩形框...")}}if(n)return;f.setTargets(i,"selected")}),y.Util.addEvtHandler(t,"mousewheel",function(t){y.Util.preventDefault(t);var e=y.Util.getMouseXY(f._container,t),i=y.Util.screenToWorld(f,e.x,e.y);if("pan"===f.mode){var n=t.wheelDelta||-t.detail;if(0<n){if(f.zoom<=this.zoomMin)return;var s=(i.x-f.cx)*(1-f.zoomScale),o=(i.y-f.cy)*(1-f.zoomScale),r=i.x-s,a=i.y-o;f.setCenter(r,a),f.zoomIn(1)}else{if(f.zoom>=this.zoomMax)return;var h=(i.x-f.cx)/(1-f.zoomScale),l=(i.y-f.cy)/(1-f.zoomScale),u=i.x-h,c=i.y-l;f.setCenter(u,c),f.zoomOut(1)}}})},setTargets:function(t,e){for(var i=this.getAllLayers(),n=[],s=0;s<i.length;s++)n=n.concat(i[s].getFeaturesWithPos(t));return"selected"===e?this.userFetureSelected&&this.userFetureSelected(n):"hover"===e&&this.userFetureHover&&this.userFetureHover(n),this},resetLayerStatus:function(){for(var t=this.getAllLayers(),e=0;e<t.length;e++)"featureLayer"===t[e].oClass&&t[e].resetFeatureStatus()},addLayer:function(t){var e=this.oLayers;y.Util.isObjInArray(e,t)||(t.onAdd(this),e.push(t))},removeLayer:function(t){},getAllLayers:function(){return this.oLayers},getNewZoom:function(t,e){for(var i=e||6,n=this.zoom;0<i;)"zoomIn"===t?n-=n*this.zoomScale:n/=1-this.zoomScale,i--;return n},zoomIn:function(t){if(!(this.zoom<=this.zoomMin)){var e=this.getAllLayers(),i=this.getNewZoom("zoomIn",t);this.zoom=i;for(var n=0;n<e.length;n++)e[n].zoomIn()}},zoomOut:function(t){if(!(this.zoom>=this.zoomMax)){var e=this.getAllLayers(),i=this.getNewZoom("zoomOut",t);this.zoom=i;for(var n=0;n<e.length;n++)e[n].zoomOut()}},setMode:function(t,e){this.mode=t,this.globalStyle=e||new y.Style({})},getMode:function(){return this.mode},setCenter:function(t,e){this.cx=t,this.cy=e},getCenter:function(){return{x:this.cx,y:this.cy}},getScreenCenter:function(){return{x:this.w/2,y:this.h/2}}},"setCenter",function(t,e){this.cx=t,this.cy=e}),e(t,"destroy",function(){this._container.innerHTML="";var t=this._container;y.Util.removeEvtHandler(t,"mousedown"),y.Util.removeEvtHandler(t,"mousemove"),y.Util.removeEvtHandler(t,"mouseup"),y.Util.removeEvtHandler(t,"mousewheel")}),t)),y.Layer=gClass.extend({init:function(t,e){this.id=t,this.visible=!0,this.options={opacity:1,zIndex:0}},onAdd:function(t){this._map=t,this._container=t.getContainer();var e=t.getSize();this._initLayerContainer(this.id,e.w,e.h),this._initProp(t),this._initParams(t),this._container.appendChild(this._layerContainer),this.setzIndex(),this.setOpacity(this.options.opacity)},onRemove:function(t){},_initProp:function(t){},_initParams:function(t){},onDrag:function(t,e){this._layerContainer.style.left=this.startLeft+t+"px",this._layerContainer.style.top=this.startTop+e+"px"},zoomIn:function(){this.renew()},zoomOut:function(){this.renew()},zoomTo:function(){this.renew()},renew:function(){this._layerContainer.style.left="0px",this._layerContainer.style.top="0px"},getSize:function(){return{w:this._layerContainer.clientWidth,h:this._layerContainer.clientHeight}},getScreenCenter:function(){return{x:parseInt(this._layerContainer.clientWidth/2,10),y:parseInt(this._layerContainer.clientHeight/2,10)}},getMap:function(){return this._map},getLayerContainer:function(){return this._layerContainer},setzIndex:function(){isNaN(this.options.zIndex)||(this._layerContainer.style.zIndex=this.options.zIndex)},setOpacity:function(t){this.getLayerContainer().style.opacity=t},resize:function(){this._layerContainer.style.width=this._map.w+"px",this._layerContainer.style.height=this._map.h+"px"},getFeaturesWithPos:function(t){return[]},deSelect:function(){}}),y.Layer.Image=y.Layer.extend({init:function(t,e,i,n){this._super(t,n),this._src=e,this._size=i,this.oClass="imgLayer"},_initParams:function(t){},_initProp:function(t){this._super(),this._mapImg||(this._mapImg=new Image),this._mapImg.style.position="absolute",this._mapImg.src=this._src,this._mapImg.onmousedown=function(t){t.preventDefault()},this._layerContainer.appendChild(this._mapImg),this.renew()},_initLayerContainer:function(t,e,i){var n=y.Util.createDiv(t,e,i,!0);n.style.zIndex=2,this._layerContainer=n},onAdd:function(t){this._super(t)},zoomTo:function(){},renew:function(){this._super();var t=this._map.getSize(),e=this._map.zoom/t.w;this._mapImg.width=this._size.w/e;var i=y.Util.worldToScreen(this._map,-1*this._size.w/2,this._size.h/2);this._mapImg.style.left=i.x+"px",this._mapImg.style.top=i.y+"px"},resize:function(){},refresh:function(){}}),y.Layer.Feature=y.Layer.extend({init:function(t,e){e=e||{},this._super(t,e),this.featureStyle=e.style||new y.Style({}),this.featureHoverStyle=e.hoverStyle||new y.Style({strokeColor:"#FF0000",lineWeight:2}),this.featureActiveStyle=e.activeStyle||new y.Style({strokeColor:"#FF0000",lineWeight:2}),this._opacity=!!e.transparent&&e.transparent,this.oClass="featureLayer"},_initLayerContainer:function(t,e,i){var n=y.Util.createCanvas(t,e,i,!0);this._layerContainer=n,this._ctx=n.getContext("2d"),this._layerContainer.style.left="0px",this._layerContainer.style.top="0px"},_initProp:function(t){this._super()},onAdd:function(t){var e=(this._map=t).getSize(),i=this._map.getContainer();this._initLayerContainer(this.id,e.w,e.h),i.appendChild(this._layerContainer),this.setzIndex(),this.oFeatures=[]},addFeature:function(t){var e=this.getAllFeatures();y.Util.isInArray(e,t)||(e.push(t),t.onAdd(this))},getFeatureById:function(t){for(var e=this.getAllFeatures(),i=e.length-1;0<=i;i--)if(e[i].id===t)return e[i];return null},getFeaturesWithPos:function(t){for(var e=[],i=this.getAllFeatures(),n=i.length-1;0<=n;n--)i[n].pointInFeature(t)&&e.push(i[n]);return e},resetFeatureStatus:function(t){for(var e=this.getAllFeatures(),i=e.length-1;0<=i;i--)t&&"active"===t?e[i].activeSatus=!1:e[i].hoverStatus=(t&&"hover"===t||(e[i].activeSatus=!1),!1);this.renew()},getActiveFeatures:function(){for(var t=[],e=this.getAllFeatures(),i=e.length-1;0<=i;i--)e[i].activeSatus&&t.push(e[i]);return t},getHoverFeatures:function(){for(var t=[],e=this.getAllFeatures(),i=e.length-1;0<=i;i--)e[i].hoverStatus&&t.push(e[i]);return t},removeAllFeatures:function(){this.oFeatures=[],this.renew()},removeFeature:function(t){for(var e=[],i=0,n=0;i<this.oFeatures.length;i++)this.oFeatures[i]!=t?(e[n]=this.oFeatures[i],n++):t.onRemove(this);this.oFeatures=e,this.renew()},removeFeatureById:function(t){for(var e=[],i=0,n=0;i<this.oFeatures.length;i++)this.oFeatures[i].id!==t?(e[n]=this.oFeatures[i],n++):this.oFeatures[i].onRemove(this);this.oFeatures=e,this.renew()},draw:function(){for(var t=this.getAllFeatures(),e=0;e<t.length;e++)t[e].onDraw(this)},renew:function(){this._super(),this.clear(),this.draw()},resize:function(){this._super(),this._layerContainer.width=this._map.w,this._layerContainer.height=this._map.h,this.renew()},clear:function(){var t=this.getLayerContainer();this._ctx.clearRect(0,0,t.width,t.height)},getAllFeatures:function(){return this.oFeatures},getCtx:function(){return this._ctx}}),y.Layer.Overlay=y.Layer.Feature.extend({init:function(t,e){this._super(t,e),this.options=e||{opacity:1,zIndex:10},this.oClass="overlayLayer"},setStyle:function(t){this.style=t},initStyle:function(){var t=this.getCtx();t.strokeStyle="green",t.fillStyle="green",this._layerContainer.style.left="0px",this._layerContainer.style.top="0px",t.gloablAlpha=.7},onAdd:function(t){this._super(t),this.initStyle()},resize:function(){this._super(),this._layerContainer.width=this._map.w,this._layerContainer.height=this._map.h,this.renew()}}),y.Layer.Marker=y.Layer.extend({init:function(t,e){this._super(t,e),this.options=e||{opacity:1,zIndex:20},this.id=t,this.oClass="markerLayer",this.oMarkers=[]},_initLayerContainer:function(t,e,i){var n=y.Util.createDiv(t,e,i,!0);this._layerContainer=n},addMarker:function(t){y.Util.isInArray(this.oMarkers,t)||(this.oMarkers.push(t),t.onAdd(this))},removeMarker:function(t){for(var e=[],i=0,n=0;i<this.oMarkers.length;i++)this.oMarkers[i]!=t?(e[n]=this.oMarkers[i],n++):this.oMarkers[i].onRemove(this);this.oMarkers=e,this.renew()},removeMarkerById:function(t){for(var e=[],i=0,n=0;i<this.oMarkers.length;i++)this.oMarkers[i].id!==t?(e[n]=this.oMarkers[i],n++):this.oMarkers[i].onRemove(this);this.oMarkers=e,this.renew()},getAllMarkers:function(){return this.oMarkers},addMarkers:function(t){this.oMarkers;for(var e=0;e<t.length;e++)this.addMarker(t[e])},removeMarkers:function(t){for(var e=t,i=e.length,n=0;n<i;n++){var s=e[n];this.removeMarker(s)}},removeAllMarkers:function(){var t=this.oMarkers;this.removeMarkers(t)},renew:function(){this._super();for(var t=0;t<this.oMarkers.length;t++)this.oMarkers[t].renew()},resize:function(){this._super(),this.renew()}}),y.Layer.Text=y.Layer.extend({init:function(t,e){this._super(t,e),this.options=e||{opacity:1,zIndex:19},this.id=t,this.oClass="textLayer",this.oTexts=[]},_initLayerContainer:function(t,e,i){var n=y.Util.createDiv(t,e,i,!0);this._layerContainer=n},addText:function(t){y.Util.isInArray(this.oTexts,t)||(this.oTexts.push(t),t.onAdd(this))},removeText:function(t){for(var e=[],i=0,n=0;i<this.oTexts.length;i++)this.oTexts[i]!=t?(e[n]=this.oTexts[i],n++):this.oTexts[i].onRemove(this);this.oTexts=e,this.renew()},getTextById:function(t){for(var e=0;e<this.oTexts.length;e++)if(this.oTexts[e].id===t)return this.oTexts[e];return null},removeTextById:function(t){for(var e=[],i=0,n=0;i<this.oTexts.length;i++)this.oTexts[i].id!=t?(e[n]=this.oTexts[i],n++):this.oTexts[i].onRemove(this);this.oTexts=e,this.renew()},addTexts:function(t){this.oTexts;for(var e=0;e<t.length;e++)this.addText(t[e])},removeTexts:function(t){for(var e=t,i=e.length,n=0;n<i;n++){var s=e[n];this.removeText(s)}},getAllTexts:function(){return this.oTexts},removeAllTexts:function(){this._layerContainer.innerHTML="",this.oTexts=[],this.renew()},renew:function(){this._super();for(var t=0;t<this.oTexts.length;t++)this.oTexts[t].renew()},resize:function(){this._super(),this.renew()}}),y});