(function(global) {

    (function(){var a=false;gClass=function(){};gClass.extend=function(e){var c=null;if(this!==gClass){c=this}function d(){if(!a){if(c){this._superprototype=c.prototype}this.init.apply(this,arguments)}}if(c){a=true;d.prototype=new c();d.prototype.constructor=d;a=false}d.extend=arguments.callee;for(var b in e){if(e.hasOwnProperty(b)){if(c&&typeof(e[b])==="function"&&typeof(d.prototype[b])==="function"&&/\b_super\b/.test(e[b])){d.prototype[b]=(function(f,g){return function(){this._super=c.prototype[f];return g.apply(this,arguments)}})(b,e[b])}else{d.prototype[b]=e[b]}}}return d}})();var gDBox={};gDBox.config={"version":"1.1.0"};gDBox.Util={};gDBox.Util.createDiv=function(e,a,b,d){var c=document.createElement("div");c.id=e;c.style.width=a+"px";c.style.height=b+"px";if(d){c.style.position="absolute"}c.style.zIndex=1;return c};gDBox.Util.createCanvas=function(e,a,c,d){var b=document.createElement("canvas");b.id=e;b.width=a;b.height=c;b.style.width=a+"px";b.style.height=c+"px";if(d){b.style.position="absolute"}return b};gDBox.Util.isInArray=function(a,c){for(var b in a){if(a[b]==c){return true}}return false};gDBox.Util.isObjInArray=function(a,c){for(var b in a){if(a[b].id==c.id){alert("已被添加，请更换图层id"+c.id);return true}}return false};gDBox.Util.setStyle=function(a,b){a.fillStyle=b.fillColor;a.strokeStyle=b.strokeColor;a.lineWidth=b.lineWeight;a.globalAlpha=b.opacity;return true};gDBox.Util.worldToScreen=function(c,h,f){var i=c.getCenter();var b=i.x;var a=i.y;var g=parseInt(c.w)/2;var e=parseInt(c.h)/2;var d=c.zoom/parseInt(c.w);var k=parseFloat(g)+parseFloat((h-b)/d)+0;var j=parseFloat(e)-parseFloat((f-a)/d)+0;return{x:k,y:j}};gDBox.Util.screenToWorld=function(c,k,j){var i=c.getCenter();var b=i.x;var a=i.y;var g=parseInt(c.w)/2;var e=parseInt(c.h)/2;var d=c.zoom/parseInt(c.w);var h=parseFloat(b)+parseFloat((k-g)*d);var f=parseFloat(a)-parseFloat((j-e)*d);return{x:h,y:f}};gDBox.Util.addEvtHandler=function(b,a,c){b["on"+a]=c;if(a=="mousewheel"&&gDBox.Util.getIEVersion()==0){b.addEventListener("DOMMouseScroll",c,false)}};gDBox.Util.removeEvtHandler=function(b,a){b["on"+a]=null};gDBox.Util.getMouseXY=function(d,g){var a=0,h=0;var f=g.srcElement?g.srcElement:g.target;if(f.nodeType!=1){return{x:a,y:h}}if(!document.attachEvent){while(f&&f!=d){var c=gDBox.Util.getEleStyle(f,"border-top-width")=="medium"?0:gDBox.Util.delpx(gDBox.Util.getEleStyle(f,"border-top-width"));var b=gDBox.Util.getEleStyle(f,"border-left-width")=="medium"?0:gDBox.Util.delpx(gDBox.Util.getEleStyle(f,"border-left-width"));a+=f.offsetLeft+b;h+=f.offsetTop+c;f=f.offsetParent}a=g.offsetX+a+document.body.scrollLeft;h=g.offsetY+h+document.body.scrollTop}else{var c=gDBox.Util.getEleStyle(f,"border-top-width")=="medium"?0:gDBox.Util.delpx(gDBox.Util.getEleStyle(f,"border-top-width"));var b=gDBox.Util.getEleStyle(f,"border-left-width")=="medium"?0:gDBox.Util.delpx(gDBox.Util.getEleStyle(f,"border-left-width"));a=g.layerX-b;h=g.layerY-c}return{x:a,y:h}};gDBox.Util.getMousePos=function(a){var b=a||window.event;return{"x":b.screenX,"y":b.screenY}};gDBox.Util.getEleStyle=function(e,d){var b=d.split("-");var a=b[0];if(a.length>1){for(var c=1;c<b.length;c++){a+=b[c].substring(0,1).toUpperCase()+b[c].substring(1)}}else{a=d}return e.currentStyle?e.currentStyle[a]:document.defaultView.getComputedStyle(e,false)[a]};gDBox.Util.delpx=function(a){if(a==""){return 0}return parseInt(a.substring(0,a.length-2))};gDBox.Util.getRectPointsWithSAndE=function(f,c){var b=c.x;var a=f.y;var e=f.x;var d=c.y;return[{x:f.x,y:f.y},{x:b,y:a},{x:c.x,y:c.y},{x:e,y:d}]};gDBox.Util.pointInPoly=function(f,e){for(var g=false,d=-1,a=e.length,b=a-1;++d<a;b=d){((e[d].y<=f.y&&f.y<e[b].y)||(e[b].y<=f.y&&f.y<e[d].y))&&(f.x<(e[b].x-e[d].x)*(f.y-e[d].y)/(e[b].y-e[d].y)+e[d].x)&&(g=!g)}return g};gDBox.Util.preventDefault=function(a){if(a.preventDefault){a.preventDefault()}else{window.event.returnValue=false}};gDBox.Util.stopPropagation=function(a){if(a.stopPropagation){a.stopPropagation()}else{window.event.cancelBubble=true}};gDBox.Util.getButton=function(a){a=a||window.event;if(!+[1,]){switch(a.button){case 0:case 1:case 3:case 5:case 7:return 0;case 2:case 6:return 2;case 4:return 1}}else{return a.button}};gDBox.Util.createTextArea=function(e,a,b,d){var c=document.createElement("textarea");c.id=e;c.style.width=a+"px";c.style.height=b+"px";c.style.resize="none";if(d){c.style.position="absolute"}c.style.zIndex=1;return c};gDBox.Util.colorRgb=function(e,c){var b=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;var f=e.toLowerCase();if(f&&b.test(f)){if(f.length===4){var g="#";for(var d=1;d<4;d+=1){g+=f.slice(d,d+1).concat(f.slice(d,d+1))}f=g}var a=[];for(var d=1;d<7;d+=2){a.push(parseInt("0x"+f.slice(d,d+2)))}return"RGBA("+a.join(",")+","+c+")"}else{return f}};gDBox.Util.getIEVersion=function(){var a=window.navigator.userAgent.toLowerCase();if(/msie 8\.0/i.test(a)){return 8}if(/msie 7\.0/i.test(a)){return 7}if(/msie 6\.0/i.test(a)){return 6}return 0};gDBox.Graph={};gDBox.Graph.drawPoint=function(a,b){a.beginPath();a.arc(b.x,b.y,2,0,Math.PI*2,true);
        a.closePath();a.fill()};gDBox.Graph.drawPoint_geo=function(b,a,c){var d=gDBox.Util.worldToScreen(b,c.x,c.y);a.beginPath();a.arc(d.x,d.y,3,0,Math.PI*2,true);a.closePath();a.fill()};gDBox.Graph.drawPoints=function(b,a){for(var c=0;c<a.length;c++){var d={x:a[c].x,y:a[c].y};this.drawPoint(b,d)}};gDBox.Graph.drawPoints_geo=function(c,b,a){for(var d=0;d<a.length;d++){var e=gDBox.Util.worldToScreen(c,a[d].x,a[d].y);this.drawPoint(b,e)}};gDBox.Geometry=gClass.extend({init:function(a){this.name=a},getVertices:function(){},getBounds:function(){},calcBounds:function(){}});gDBox.Geometry.Point=gClass.extend({init:function(a,b){this.x=a;this.y=b;this.className="point"}});gDBox.Geometry.LineString=gDBox.Geometry.extend({init:function(b){this.className="line";this.points=[];for(var a=0;a<b.length;a++){var c=b[a];if(c instanceof gDBox.Geometry.Point){this.points.push(c)}else{alert("初始化节点失败！")}}},addPoint:function(c,a){var b=/^\d+$/;if(b.test(a)){this.points.splice(a,0,c)}else{this.points.push(c)}},delPoint:function(a){this.points.splice(a,1)},removePoint:function(b){for(var a=0;a<this.points.length;a++){if(this.points[a]==b){this.points.splice(a,1);break}}},getLength:function(){var a=this.points.length;var d=0;for(var b=0;b<(a-1);b++){var c=Math.sqrt((this.points[b].x-this.points[b+1].x)*(this.points[b].x-this.points[b+1].x)+(this.points[b].y-this.points[b+1].y)*(this.points[b].y-this.points[b+1].y));d=d+c}return d}});gDBox.Geometry.LinearRing=gDBox.Geometry.LineString.extend({init:function(a){var b=a.length;if(b<=2){alert("组成多边形节点个数不足！");return}this._super(a);this.className="polygon";var c=a[0];this.points.push(c)},addPoint:function(b,a){this.points.splice(a,0,b)},delPoint:function(a){if(this.points.length==4){alert("节点数低于3个，不能删除！");return}this.points.splice(a,1);if(a==0){this.points.pop();var b=this.points[0];this.points.push(b)}else{}},getCenterPoint:function(){var c=this.points;var e=c.length;var g=0;var f=0;for(var d=0;d<e;d++){g=g+c[d].x;f=f+c[d].y}var b=g/e;var h=f/e;var a=new gDBox.Geometry.Point(b,h);return a},getArea:function(){var b=0;var d=this.points;for(var c=0;c<d.length;c++){b=b+(d[c].x*d[(c+1)%d.length].y-d[(c+1)%d.length].x*d[c].y)}var a=parseInt(Math.abs(0.5*b));return a}});gDBox.Geometry.RectRing=gDBox.Geometry.LineString.extend({init:function(a){var b=a.length;if(b<4){alert("组成矩形节点个数不足！");return}this._super(a);this.className="rect"},addPoint:function(b,a){this.points.splice(a,0,b)},delPoint:function(a){if(this.points.length==4){alert("节点数低于3个，不能删除！");return}this.points.splice(a,1);if(a==0){this.points.pop();var b=this.points[0];this.points.push(b)}else{}},getArea:function(){var b=0;var d=this.points;for(var c=0;c<d.length;c++){b=b+(d[c].x*d[(c+1)%d.length].y-d[(c+1)%d.length].x*d[c].y)}var a=parseInt(Math.abs(0.5*b));return a}});gDBox.Geometry.RadiusRing=gDBox.Geometry.extend({init:function(b,a){this.radius=a;this.centerPoint=b;this.className="radius"},getArea:function(){return 2*3.14159*(this.radius)*(this.radius)}});gDBox.Feature=gClass.extend({init:function(){},getVertices:function(){return this.points},getBounds:function(){var c=this.getVertices();var a=c[0].x,f=c[0].y,e=c[0].x,d=c[0].y;for(var b=1;b<c.length;b++){if(a>c[b].x){a=c[b].x}if(e<c[b].x){e=c[b].x}if(f>c[b].y){f=c[b].y}if(d<c[b].y){d=c[b].y}}return[{x:a,y:d},{x:e,y:d},{x:e,y:f},{x:a,y:f}]},calcBounds:function(){}});gDBox.Feature.Polygon=gDBox.Feature.extend({init:function(a,b,c){this.points=a;this.data=b||{};this.style=c||new gDBox.Style({})},onAdd:function(a){this._layerID=a.id;this._layer=a;this.onDraw(a)},onRemove:function(a){},update:function(a){this.points=a.points||this.points;this.data=a.data||this.data;this.style=a.style||this.style;this._layer.renew()},onDraw:function(e){var b=e.getCtx();var d=gDBox.Util.setStyle(b,this.style);if(this.select){b.strokeStyle="#FF0000";b.lineWidth=2}var f=e.getMap();b.globalAlpha=1;var a=this.points.length;if(a>=2){b.beginPath();var g=gDBox.Util.worldToScreen(e._map,this.points[0].x,this.points[0].y);b.moveTo(g.x,g.y);for(var c=1;c<a;c++){g=gDBox.Util.worldToScreen(e._map,this.points[c].x,this.points[c].y);b.lineTo(g.x,g.y)}b.closePath()}b.stroke();if(e._opacity){b.globalAlpha=0}else{b.globalAlpha=this.style.opacity}b.fill();if(this.select){b.globalAlpha=1;b.fillStyle="#FF0000";gDBox.Graph.drawPoints_geo(f,b,this.points)}}});gDBox.Marker=gClass.extend({init:function(a,b){this.name=a;this._img=new Image();this._img.src=b.src;this.src=b.src;this._img.style.position="absolute";this._img.style.zIndex=100;this.info=b},onAdd:function(b){this._layer=b;var c=b.getMap();var a=this._container=b.getLayerContainer();this.x=this.info.x;this.y=this.info.y;var d=gDBox.Util.worldToScreen(c,this.info.x,this.info.y);this._img.style.left=d.x+this.info.offset.x+"px";this._img.style.top=d.y+this.info.offset.y+"px";this._img.style.cursor="pointer";a.appendChild(this._img)},onRemove:function(){this._container.removeChild(this._img)},regEvent:function(a,c){if(a=="click"){var b=this;gDBox.Util.addEvtHandler(this._img,"mousedown",function(d){gDBox.Util.preventDefault(d);
        gDBox.Util.stopPropagation(d)});gDBox.Util.addEvtHandler(this._img,"mouseup",function(d){if(gDBox.Util.getButton(d)==0){c.apply(b,arguments)}gDBox.Util.preventDefault(d);gDBox.Util.stopPropagation(d)});gDBox.Util.addEvtHandler(this._img,"click",function(d){gDBox.Util.preventDefault(d);gDBox.Util.stopPropagation(d)})}else{if(a=="Rclick"){}}},renew:function(){var a=this._layer.getMap();var b=gDBox.Util.worldToScreen(a,this.info.x,this.info.y);this._img.style.left=b.x+this.info.offset.x+"px";this._img.style.top=b.y+this.info.offset.y+"px"},showInfo:function(){console.log("Hello ...")}});gDBox.Text=gClass.extend({init:function(c,a,b){this.id=c;this.startPoint=a.pos;this.offset=a.offset||{x:0,y:0};this.boxMaxWidth=a.width;this.wrap=a.wrap||false;this.text=a.text;this.style=b||new gDBox.Style({})},onAdd:function(b){var d=this.id;this._w=this.boxMaxWidth;var c=gDBox.Util.createDiv(d,this._w,this._h,true);c.style.borderWidth=0;c.style.width="initial";c.style.maxWidth=this._w+"px";if(!this.wrap){c.style.overflow="hidden";c.style.textOverflow="ellipsis";c.style.whiteSpace="nowrap"}this._textContainer=c;var a=this._container=b.getLayerContainer();a.appendChild(this._textContainer);this._layer=b;this.onDraw(b)},onDraw:function(c){var a=gDBox.Util.worldToScreen(c._map,this.startPoint.x,this.startPoint.y);a.x=a.x+this.offset.x;a.y=a.y+this.offset.y;this._textContainer.style.fontSize=this.style.fontSize+"px";this._textContainer.style.lineHeight=this.style.fontSize+"px";this._textContainer.style.fontFamily=this.style.fontFamily+",SimSun";this._textContainer.style.color=this.style.fontColor;this._textContainer.style.borderRadius="1px";this._textContainer.style.boxSizing="border-box";this._textContainer.style.padding="1px";var b=gDBox.Util.colorRgb(this.style.bgColor,this.style.opacity||1);this._textContainer.style.background=b;this._textContainer.textContent=this.text;this._textContainer.style.left=a.x+"px";this._textContainer.style.top=a.y+"px";c._layerContainer.appendChild(this._textContainer)},setText:function(a){this.text=a;this.refresh()},setPosition:function(b,a){this.startPoint.x=b;this.startPoint.y=a},setSize:function(a){this._w=this.boxMaxWidth=a},onRemove:function(){this._container.removeChild(this._textContainer)},getContainer:function(){return this._textContainer},renew:function(){var a=this._layer;this.onDraw(a)},refresh:function(){this.renew()}});gDBox.Style=gClass.extend({init:function(a){this.oStyle="singleStyle";if(a.fillColor==undefined){this.fillColor="#00DD00"}else{this.fillColor=a.fillColor}if(a.strokeColor==undefined){this.strokeColor="#00DD00"}else{this.strokeColor=a.strokeColor}if(a.lineWeight==undefined){this.lineWeight=1}else{this.lineWeight=a.lineWeight}if(a.borderStatus==undefined){this.borderStatus=true}else{this.borderStatus=false}if(a.cirRadius==undefined){this.cirRadius=3}else{this.cirRadius=a.cirRadius}if(a.fillStatus==undefined){this.fillStatus=true}else{this.fillStatus=false}if(a.vtxStatus==undefined){this.vtxStatus=false}else{this.vtxStatus=true}if(a.vtxRadius==undefined){this.vtxRadius=3}else{this.vtxRadius=a.vtxRadius}if(a.tlr==undefined){this.tlr=5}else{this.tlr=a.tlr}if(a.opacity==undefined){this.opacity=1}else{this.opacity=a.opacity}if(a.mappingValue==undefined){this.mappingValue="default"}else{this.mappingValue=a.mappingValue}if(a.fontSize==undefined){this.fontSize=13}else{this.fontSize=a.fontSize}if(a.fontFamily==undefined){this.fontFamily="KaiTi"}else{this.fontFamily=a.fontFamily}if(a.fontColor==undefined){this.fontColor="#333333"}else{this.fontColor=a.fontColor}if(a.bgColor==undefined){this.bgColor="#ffffff"}else{this.bgColor=a.bgColor}}});gDBox.Style_Ex=gClass.extend({init:function(a,b){this.oStyle="multiStyles";this.styles=a;this.mappingField=b}});gDBox.Map=gClass.extend({init:function(a,b){this._options=b||{};this._initContainer(a);this._initProp();this._initEvent();this.overLayer=new gDBox.Layer.Overlay("overlay");this.mLayer=new gDBox.Layer.Marker("markerLayer");this.addLayer(this.overLayer);this.addLayer(this.mLayer)},_initContainer:function(a){this._container=document.getElementById(a);this._container.innerHTML="";this.w=this._options.w||this._container.clientWidth;this.h=this._options.h||this._container.clientHeight;this._container.style.overflow="hidden"},getContainer:function(){return this._container},getSize:function(){return{w:this.w,h:this.h}},events:{on:function(a,b){switch(a){case"mouseDown":gDBox.Map.prototype._mouseDown_EX=function(c){b(c)};break;case"geometryDone":gDBox.Map.prototype._geometryDone_EX=function(d,c){b(d,c)};break;case"selected":gDBox.Map.prototype._fetureSelected_EX=function(c){b(c)};break}}},_mouseDown_EX:function(){},_geometryDone_EX:function(){},_fetureSelected_EX:function(){},_initProp:function(){this.mode="pan";this.selectMode="up";this.dragging=false;this.oLayers=[];this.zoom=this._options.zoom||parseInt(1*this.w);this.cx=this._options.cx||0;this.cy=this._options.cy||0;this.startX=0;this.startY=0;this.startScrX=0;this.startSrcY=0;this.zoomScale=1/40;
        this.zoomMax=this._options.zoomMax||1000000000;this.zoomMin=this._options.zoomMin||0;this.draw_rect_points=[]},_initEvent:function(){var g=this;var l=document.documentElement;var j=this._container;gDBox.Util.addEvtHandler(j,"mousedown",f);gDBox.Util.addEvtHandler(j,"mousemove",d);gDBox.Util.addEvtHandler(j,"mouseup",a);gDBox.Util.addEvtHandler(j,"mousewheel",c);function f(p){var p=p?p:window.event;if(!window.event){p.preventDefault()}var n=gDBox.Util.getMouseXY(g._container,p);var o=gDBox.Util.screenToWorld(g,n.x,n.y);var m=gDBox.Util.getMousePos(p);g.startX=n.x;g.startY=n.y;g.startScrX=m.x;g.startScrY=m.y;g._mouseDown_EX&&g._mouseDown_EX(o);if(g.mode=="pan"){k(p);document.onmousemove=function(q){h(q)};document.onmouseup=function(q){document.onmousemove=null;document.onmouseup=null;i(q)}}else{b(p)}}function k(o){g.dragging=true;var m=g.getAllLayers();for(var n=0;n<m.length;n++){m[n].startLeft=gDBox.Util.delpx(m[n]._layerContainer.style.left);m[n].startTop=gDBox.Util.delpx(m[n]._layerContainer.style.top)}}function h(s){var o=gDBox.Util.getMouseXY(g._container,s);var n=gDBox.Util.getMousePos(s);if(g.dragging){var r=n.x-g.startScrX;var q=n.y-g.startScrY;var m=g.getAllLayers();if(Math.abs(r)>0||Math.abs(q)>0){for(var p=0;p<m.length;p++){m[p].onDrag(r,q)}}}}function i(p){var t=gDBox.Util.getMouseXY(g._container,p);var x=gDBox.Util.getMousePos(p);var v=x.x-g.startScrX;var u=x.y-g.startScrY;if(Math.abs(v)>0||Math.abs(u)>0){var o=g.getScreenCenter();var r=o.x-v;var q=o.y-u;var w=gDBox.Util.screenToWorld(g,r,q);g.setCenter(w.x,w.y);var s=g.getAllLayers();var m=s.length;for(var n=0;n<m;n++){s[n].renew()}}g.dragging=false}function b(p){var m=gDBox.Util.getMouseXY(g._container,p);var n=gDBox.Util.screenToWorld(g,m.x,m.y);switch(g.mode){case"drawRect":var o=new gDBox.Geometry.Point(n.x,n.y);g.draw_rect_points.push(o);break;case"select":if(g.selectMode==="up"){return}e(n);break}}function e(p){var n=g.getAllLayers();var m=[];for(var o=0;o<n.length;o++){m=m.concat(n[o].getSelectTarget({x:p.x,y:p.y}))}g._fetureSelected_EX&&g._fetureSelected_EX(m);return m}function d(r){var o=gDBox.Util.getMouseXY(g._container,r);var q=gDBox.Util.screenToWorld(g,o.x,o.y);switch(g.mode){case"drawRect":if(g.draw_rect_points.length>0){g.overLayer.clear();var n=g.overLayer.getCtx();gDBox.Util.setStyle(n,g.globalStyle);var m=o.x-g.startX;var p=o.y-g.startY;n.strokeRect(g.startX,g.startY,m,p)}break}}function a(r){var m=gDBox.Util.getMouseXY(g._container,r);var o=gDBox.Util.screenToWorld(g,m.x,m.y);switch(g.mode){case"drawRect":var q=g.draw_rect_points[0];g.draw_rect_points=[];var n=new gDBox.Geometry.Point(o.x,o.y);var s=gDBox.Util.getRectPointsWithSAndE(q,n);g.overLayer.clear();if(Math.abs(s[0].x-s[2].x)>10&&Math.abs(s[0].y-s[2].y)>10){g._geometryDone_EX&&g._geometryDone_EX("rect",s)}else{if(g.selectMode==="down"){return}var p=e(o);if(!p.length){console.log("invalid points data: 不是有效矩形框...")}}break}}function c(s){gDBox.Util.preventDefault(s);var n=gDBox.Util.getMouseXY(g._container,s);var r=gDBox.Util.screenToWorld(g,n.x,n.y);if(g.mode==="pan"){var t=s.wheelDelta||-s.detail;if(t>0){if(g.zoom<=this.zoomMin){return}var q=(r.x-g.cx)*(1-g.zoomScale);var p=(r.y-g.cy)*(1-g.zoomScale);var o=r.x-q;var m=r.y-p;g.setCenter(o,m);g.zoomIn(1)}else{if(g.zoom>=this.zoomMax){return}var q=(r.x-g.cx)/(1-g.zoomScale);var p=(r.y-g.cy)/(1-g.zoomScale);var o=r.x-q;var m=r.y-p;g.setCenter(o,m);g.zoomOut(1)}}}},addLayer:function(b){var a=this.oLayers;if(!gDBox.Util.isObjInArray(a,b)){b.onAdd(this);a.push(b)}},removeLayer:function(a){},setActiveLayer:function(c){var a=this.getAllLayers();for(var b=0;b<a.length;b++){if(a[b]==c){a[b].active()}else{a[b].deActive()}}},getAllLayers:function(){return this.oLayers},getNewZoom:function(d,a){var c=a?a:6;var b=this.zoom;while(c>0){if(d==="zoomIn"){b=b-(b*this.zoomScale)}else{b=b/(1-this.zoomScale)}c--}return b},zoomIn:function(b){if(this.zoom<=this.zoomMin){return}var a=this.getAllLayers();var d=this.getNewZoom("zoomIn",b);this.zoom=d;for(var c=0;c<a.length;c++){a[c].zoomIn()}},zoomOut:function(b){if(this.zoom>=this.zoomMax){return}var a=this.getAllLayers();var d=this.getNewZoom("zoomOut",b);this.zoom=d;for(var c=0;c<a.length;c++){a[c].zoomOut()}},setMode:function(b,a){this.mode=b;this.globalStyle=a||new gDBox.Style({})},getMode:function(){return this.mode},deSelect:function(){var a=this.getAllLayers();for(var b=0;b<a.length;b++){a[b].deSelect()}this.overLayer.clear();this.draw_rect_points=[]},setCenter:function(a,b){this.cx=a;this.cy=b},getCenter:function(){return{x:this.cx,y:this.cy}},getScreenCenter:function(){return{x:this.w/2,y:this.h/2}},setCenter:function(a,b){this.cx=a;this.cy=b},destroy:function(){this._container.innerHTML="";var a=this._container;gDBox.Util.removeEvtHandler(a,"mousedown");gDBox.Util.removeEvtHandler(a,"mousemove");gDBox.Util.removeEvtHandler(a,"mouseup");gDBox.Util.removeEvtHandler(a,"mousewheel")}});gDBox.Layer=gClass.extend({init:function(b,a){this.id=b;this.visible=true;this.options={opacity:1,zIndex:0}
        },onAdd:function(c){var a=this;this._map=c;this._container=c.getContainer();var b=c.getSize();this._initLayerContainer(this.id,b.w,b.h);this._initProp(c);this._initParams(c);this._container.appendChild(this._layerContainer);this.setzIndex();this.setOpacity(this.options.opacity)},onRemove:function(a){},_initProp:function(a){this.deActive()},_initParams:function(a){},onDrag:function(b,a){this._layerContainer.style.left=this.startLeft+b+"px";this._layerContainer.style.top=this.startTop+a+"px"},zoomIn:function(){this.renew()},zoomOut:function(){this.renew()},zoomTo:function(){this.renew()},renew:function(){this._layerContainer.style.left=0+"px";this._layerContainer.style.top=0+"px"},getSize:function(){return{w:this._layerContainer.clientWidth,h:this._layerContainer.clientHeight}},getScreenCenter:function(){return{x:parseInt(this._layerContainer.clientWidth/2),y:parseInt(this._layerContainer.clientHeight/2)}},getMap:function(){return this._map},getLayerContainer:function(){return this._layerContainer},setzIndex:function(){if(!isNaN(this.options.zIndex)){this._layerContainer.style.zIndex=this.options.zIndex}},setOpacity:function(a){this.getLayerContainer().style.opacity=a},resize:function(){this._layerContainer.style.width=this._map.w+"px";this._layerContainer.style.height=this._map.h+"px"},active:function(){if(this.oClass!=="featureLayer"){return}this.activeStatus=true},deActive:function(){this.activeStatus=false},getSelectTarget:function(){return[]},deSelect:function(){}});gDBox.Layer.Image=gDBox.Layer.extend({init:function(d,c,b,a){this._super(d,a);this._src=c;this._size=b;this.oClass="imgLayer"},_initParams:function(a){},_initProp:function(a){this._super();if(!this._mapImg){this._mapImg=new Image()}this._mapImg.style.position="absolute";this._mapImg.src=this._src;this._mapImg.onmousedown=function(b){b.preventDefault()};this._layerContainer.appendChild(this._mapImg);this.renew()},_initLayerContainer:function(d,a,b){var c=gDBox.Util.createDiv(d,a,b,true);c.style.zIndex=2;this._layerContainer=c},onAdd:function(a){this._super(a)},zoomTo:function(){},renew:function(){this._super();var a=this._map.getSize();var c=this._map.zoom/a.w;this._mapImg.width=this._size.w/c;var b=gDBox.Util.worldToScreen(this._map,-1*this._size.w/2,this._size.h/2);this._mapImg.style.left=b.x+"px";this._mapImg.style.top=b.y+"px"},resize:function(){},refresh:function(){}});gDBox.Layer.Feature=gDBox.Layer.extend({init:function(c,a){this._super(c,a);var b=new gDBox.Style({});this.style=b;this._opacity=(a&&a.transparent)?a.transparent:false;this.oClass="featureLayer"},_initLayerContainer:function(d,a,c){var b=gDBox.Util.createCanvas(d,a,c,true);this._layerContainer=b;this._ctx=b.getContext("2d");this._layerContainer.style.left="0px";this._layerContainer.style.top="0px"},_initProp:function(a){this._super()},onAdd:function(c){this._map=c;var b=c.getSize();var a=this._map.getContainer();this._initLayerContainer(this.id,b.w,b.h);a.appendChild(this._layerContainer);this.setzIndex();this.oFeatures=[]},addFeature:function(a){var b=this.getAllFeatures();if(!gDBox.Util.isInArray(b,a)){b.push(a);a.onAdd(this)}},getSelectTarget:function(b){var a=[];if(!this.activeStatus){return a}var e=false;var d=this.getAllFeatures();for(var c=(d.length-1);c>=0;c--){d[c].select=false;if(gDBox.Util.pointInPoly(b,d[c].points)&&!e){e=true;d[c].select=true;a.push(d[c])}}this.renew();return a.length?[a[0]]:a},deSelect:function(){var b=this.getAllFeatures();for(var a=0;a<b.length;a++){b[a].select=false}this.renew()},removeAllFeatures:function(){this.oFeatures=[];this.renew()},removeFeature:function(e){var d=[];for(var c=0,b=0;c<this.oFeatures.length;c++){if(this.oFeatures[c]!=e){d[b]=this.oFeatures[c];b++}else{e.onRemove(this)}}this.oFeatures=d;var f=this.getMap();this.renew()},draw:function(){var b=this.getAllFeatures();for(var a=0;a<b.length;a++){b[a].onDraw(this)}},renew:function(){this._super();this.clear();this.draw()},resize:function(){this._super();this._layerContainer.width=this._map.w;this._layerContainer.height=this._map.h;this.renew()},clear:function(){var a=this.getLayerContainer();this._ctx.clearRect(0,0,a.width,a.height)},getAllFeatures:function(){return this.oFeatures},getCtx:function(){return this._ctx}});gDBox.Layer.Overlay=gDBox.Layer.Feature.extend({init:function(b,a){this._super(b,a);this.options=a||{opacity:1,zIndex:10};this.oClass="overlayLayer"},setStyle:function(a){this.style=a},initStyle:function(){var a=this.getCtx();a.strokeStyle="green";a.fillStyle="green";this._layerContainer.style.left="0px";this._layerContainer.style.top="0px";a.gloablAlpha=0.7},onAdd:function(a){this._super(a);this.initStyle()},resize:function(){this._super();this._layerContainer.width=this._map.w;this._layerContainer.height=this._map.h;this.renew()}});gDBox.Layer.Marker=gDBox.Layer.extend({init:function(b,a){this._super(b,a);this.options=a||{opacity:1,zIndex:20};this.id=b;this.oClass="markerLayer";this.oMarkers=[]},_initLayerContainer:function(d,a,b){var c=gDBox.Util.createDiv(d,a,b,true);
        this._layerContainer=c},addMarker:function(a){if(!gDBox.Util.isInArray(this.oMarkers,a)){this.oMarkers.push(a);a.onAdd(this)}},removeMarker:function(c){var e=[];for(var d=0,b=0;d<this.oMarkers.length;d++){if(this.oMarkers[d]!=c){e[b]=this.oMarkers[d];b++}else{this.oMarkers[d].onRemove(this)}}this.oMarkers=e;this.renew()},getAllMarkers:function(){return this.oMarkers},addMarkers:function(c){var b=this.oMarkers;for(var a=0;a<c.length;a++){this.addMarker(c[a])}},removeMarkers:function(e){var b=e;var d=b.length;for(var a=0;a<d;a++){var c=b[a];this.removeMarker(c)}},removeAllMarkers:function(){var a=this.oMarkers;this.removeMarkers(a)},renew:function(){this._super();for(var a=0;a<this.oMarkers.length;a++){this.oMarkers[a].renew()}},resize:function(){this._super();this.renew()}});gDBox.Layer.Text=gDBox.Layer.extend({init:function(b,a){this._super(b,a);this.options=a||{opacity:1,zIndex:19};this.id=b;this.oClass="textLayer";this.oTexts=[]},_initLayerContainer:function(d,a,b){var c=gDBox.Util.createDiv(d,a,b,true);this._layerContainer=c},addText:function(a){if(!gDBox.Util.isInArray(this.oTexts,a)){this.oTexts.push(a);a.onAdd(this)}},removeText:function(b){var d=[];for(var e=0,c=0;e<this.oTexts.length;e++){if(this.oTexts[e]!=b){d[c]=this.oTexts[e];c++}else{this.oTexts[e].onRemove(this)}}this.oTexts=d;this.renew()},getTextById:function(d){for(var c=0,b=0;c<this.oTexts.length;c++){if(this.oTexts[c].id===d){return this.oTexts[c]}}return null},removeTextById:function(e){var c=[];for(var d=0,b=0;d<this.oTexts.length;d++){if(this.oTexts[d].id!=e){c[b]=this.oTexts[d];b++}else{this.oTexts[d].onRemove(this)}}this.oTexts=c;this.renew()},addTexts:function(a){var b=this.oTexts;for(var c=0;c<a.length;c++){this.addText(a[c])}},removeTexts:function(b){var e=b;var a=e.length;for(var c=0;c<a;c++){var d=e[c];this.removeText(d)}},getAllTexts:function(){return this.oTexts},removeAllTexts:function(){this._layerContainer.innerHTML="";this.oTexts=[];this.renew()},renew:function(){this._super();for(var a=0;a<this.oTexts.length;a++){this.oTexts[a].renew()}},resize:function(){this._super();this.renew()}});
    
    //兼容CommonJs规范
    if (typeof module !== 'undefined' && module.exports) {
        module.exports = gDBox;
    };
    //兼容AMD/CMD规范  
    if (typeof define === 'function') define(function() {   
        return gDBox;   
    });
    //注册全局变量，兼容直接使用script标签引入插件
    global.gDBox= gDBox;
})(window); 